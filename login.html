<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Narrow ‚Äî Sign In / Create Account</title>
  <meta name="description" content="Sign in or create your Narrow account to start your home building journey.">
  <link rel="stylesheet" href="styles.css">
  <style>
    .auth-section {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 120px 24px 60px;
      background: var(--navy-dark);
    }

    .auth-card {
      background: var(--white);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      width: 100%;
      max-width: 500px;
      overflow: hidden;
    }

    .auth-card__header {
      background: var(--navy);
      padding: 36px 40px 28px;
      text-align: center;
    }

    .auth-card__logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .auth-card__logo-text {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--white);
    }

    .auth-tabs {
      display: flex;
      border-bottom: 1px solid rgba(255,255,255,0.15);
    }

    .auth-tab {
      flex: 1;
      padding: 14px;
      background: none;
      border: none;
      color: rgba(255,255,255,0.55);
      font-family: var(--font-body);
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      border-bottom: 3px solid transparent;
      margin-bottom: -1px;
    }

    .auth-tab.active {
      color: var(--amber);
      border-bottom-color: var(--amber);
    }

    .auth-card__body {
      padding: 36px 40px 40px;
    }

    .auth-panel { display: none; }
    .auth-panel.active { display: block; }

    .form-group {
      margin-bottom: 18px;
    }

    .form-group label {
      display: block;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--charcoal);
      margin-bottom: 6px;
      letter-spacing: 0.02em;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--gray-light);
      border-radius: var(--radius-sm);
      font-family: var(--font-body);
      font-size: 0.95rem;
      color: var(--charcoal);
      background: var(--cream);
      transition: var(--transition);
      outline: none;
    }

    .form-group input:focus,
    .form-group select:focus {
      border-color: var(--navy);
      background: var(--white);
    }

    .auth-btn {
      width: 100%;
      padding: 14px;
      background: var(--amber);
      color: var(--navy-dark);
      border: none;
      border-radius: var(--radius-sm);
      font-family: var(--font-body);
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
      margin-top: 8px;
    }

    .auth-btn:hover {
      background: var(--amber-dark);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .auth-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .auth-divider {
      text-align: center;
      margin: 20px 0;
      position: relative;
    }

    .auth-divider::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0; right: 0;
      height: 1px;
      background: var(--gray-light);
    }

    .auth-divider span {
      position: relative;
      background: var(--white);
      padding: 0 12px;
      font-size: 0.8rem;
      color: var(--gray);
    }

    .auth-switch {
      text-align: center;
      margin-top: 20px;
      font-size: 0.875rem;
      color: var(--gray);
    }

    .auth-switch a {
      color: var(--navy);
      font-weight: 600;
      cursor: pointer;
      text-decoration: underline;
    }

    .auth-message {
      padding: 12px 16px;
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      margin-bottom: 16px;
      display: none;
    }

    .auth-message.success {
      background: #D1FAE5;
      color: #065F46;
      border: 1px solid #6EE7B7;
      display: block;
    }

    .auth-message.error {
      background: #FEE2E2;
      color: #991B1B;
      border: 1px solid #FCA5A5;
      display: block;
    }

    .role-cards {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-bottom: 18px;
    }

    .role-card {
      padding: 14px 8px;
      border: 2px solid var(--gray-light);
      border-radius: var(--radius-sm);
      cursor: pointer;
      text-align: center;
      transition: var(--transition);
      font-family: var(--font-body);
      background: var(--cream);
    }

    .role-card:hover {
      border-color: var(--navy-light);
      background: #F0F4FF;
    }

    .role-card.selected {
      border-color: var(--navy);
      background: #EEF2FF;
    }

    .role-card .role-icon  { font-size: 1.3rem; display: block; margin-bottom: 4px; }
    .role-card .role-label { font-size: 0.72rem; font-weight: 600; color: var(--charcoal); }

    .form-label-top {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--charcoal);
      margin-bottom: 8px;
      display: block;
    }

    .conditional-field { display: none; }
    .conditional-field.visible { display: block; }
  </style>
</head>
<body>

<!-- ‚îÄ‚îÄ NAV ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<nav class="nav">
  <div class="nav__inner">
    <a href="index.html" class="nav__logo">
      <img src="Narrow Logo.png" alt="Narrow Logo" style="width:40px;height:40px;object-fit:contain">
      <span class="nav__logo-text">Narrow</span>
    </a>
    <ul class="nav__links">
      <li><a href="index.html" class="nav__link">Home</a></li>
      <li><a href="how-it-works.html" class="nav__link">How It Works</a></li>
      <li><a href="architects.html" class="nav__link">Architect Plans</a></li>
      <li><a href="professionals.html" class="nav__link">Find Pros</a></li>
      <li><a href="about.html" class="nav__link">About</a></li>
    </ul>
    <a href="login.html" class="nav__cta">Sign In</a>
    <button class="nav__hamburger" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
  </div>
</nav>

<!-- ‚îÄ‚îÄ AUTH SECTION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<section class="auth-section">
  <div class="auth-card">

    <div class="auth-card__header">
      <div class="auth-card__logo">
        <img src="Narrow Logo.png" alt="Narrow" style="width:36px;height:36px;object-fit:contain">
        <span class="auth-card__logo-text">Narrow</span>
      </div>
      <div class="auth-tabs">
        <button class="auth-tab active" onclick="switchTab('login')">Sign In</button>
        <button class="auth-tab" onclick="switchTab('signup')">Create Account</button>
      </div>
    </div>

    <div class="auth-card__body">

      <div id="authMessage" class="auth-message"></div>

      <!-- ‚îÄ‚îÄ LOGIN PANEL ‚îÄ‚îÄ -->
      <div id="loginPanel" class="auth-panel active">
        <div class="form-group">
          <label>Email Address</label>
          <input type="email" id="loginEmail" placeholder="you@email.com">
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <button class="auth-btn" onclick="handleLogin()">Sign In ‚Üí</button>
        <div class="auth-divider"><span>new to narrow?</span></div>
        <div class="auth-switch">
          Don't have an account? <a onclick="switchTab('signup')">Create one free</a>
        </div>
        <div style="text-align:center;margin-top:12px">
          <a onclick="handleForgotPassword()" style="font-size:0.8rem;color:var(--gray);cursor:pointer;text-decoration:underline">Forgot password?</a>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ SIGNUP PANEL ‚îÄ‚îÄ -->
      <div id="signupPanel" class="auth-panel">

        <span class="form-label-top">I am a‚Ä¶</span>
        <div class="role-cards">
          <div class="role-card" onclick="selectRole(this, 'homebuyer')">
            <span class="role-icon">üè†</span>
            <span class="role-label">Homebuyer</span>
          </div>
          <div class="role-card" onclick="selectRole(this, 'architect')">
            <span class="role-icon">üìê</span>
            <span class="role-label">Architect</span>
          </div>
          <div class="role-card" onclick="selectRole(this, 'contractor')">
            <span class="role-icon">üî®</span>
            <span class="role-label">Contractor</span>
          </div>
          <div class="role-card" onclick="selectRole(this, 'agent')">
            <span class="role-icon">üè°</span>
            <span class="role-label">Real Estate Agent</span>
          </div>
          <div class="role-card" onclick="selectRole(this, 'mortgage')">
            <span class="role-icon">üí∞</span>
            <span class="role-label">Mortgage Agent</span>
          </div>
        </div>

        <!-- Core fields -->
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" id="signupName" placeholder="Jane Smith">
        </div>
        <div class="form-group">
          <label>Email Address</label>
          <input type="email" id="signupEmail" placeholder="you@email.com">
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="signupPassword" placeholder="Min. 8 characters">
        </div>

        <!-- Contractor fields -->
        <div id="contractorFields" class="conditional-field">
          <div class="form-group">
            <label>Company Name</label>
            <input type="text" id="contractorCompany" placeholder="Smith Construction LLC">
          </div>
          <div class="form-group">
            <label>License Number</label>
            <input type="text" id="contractorLicense" placeholder="State contractor license #">
          </div>
          <div class="form-group">
            <label>Service Area (City, State)</label>
            <input type="text" id="contractorArea" placeholder="Austin, TX">
          </div>
        </div>

        <!-- Architect fields -->
        <div id="architectFields" class="conditional-field">
          <div class="form-group">
            <label>Firm / Company Name</label>
            <input type="text" id="architectCompany" placeholder="Smith Architecture Studio">
          </div>
          <div class="form-group">
            <label>Architect License Number</label>
            <input type="text" id="architectLicense" placeholder="State architect license #">
          </div>
        </div>

        <!-- Real Estate Agent fields -->
        <div id="agentFields" class="conditional-field">
          <div class="form-group">
            <label>Brokerage Name</label>
            <input type="text" id="agentBrokerage" placeholder="Keller Williams, Compass, etc.">
          </div>
          <div class="form-group">
            <label>RE License Number</label>
            <input type="text" id="agentLicense" placeholder="State RE license #">
          </div>
          <div class="form-group">
            <label>Service Area (City, State)</label>
            <input type="text" id="agentArea" placeholder="Austin, TX">
          </div>
        </div>

        <!-- Mortgage Agent fields -->
        <div id="mortgageFields" class="conditional-field">
          <div class="form-group">
            <label>Company / Lender Name</label>
            <input type="text" id="mortgageCompany" placeholder="First National Bank, etc.">
          </div>
          <div class="form-group">
            <label>NMLS Number</label>
            <input type="text" id="mortgageNmls" placeholder="Your NMLS license #">
          </div>
          <div class="form-group">
            <label>Licensed States</label>
            <input type="text" id="mortgageStates" placeholder="TX, OK, AR, LA">
          </div>
        </div>

        <button class="auth-btn" onclick="handleSignup()">Create My Account ‚Üí</button>
        <div class="auth-switch" style="margin-top:16px">
          Already have an account? <a onclick="switchTab('login')">Sign in</a>
        </div>
      </div>

    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // Initialize Supabase (standalone - no main.js on this page)
  const { createClient } = window.supabase;
  window.narrowSupabase = createClient(
    'https://okalotfqhmwiyckhvcmk.supabase.co',
    'sb_publishable_YrgPXrGiPlCY1Mdhw_NYpw_jO36M2iZ'
  );

  let selectedRole = null;

  function switchTab(tab) {
    document.querySelectorAll('.auth-tab').forEach((t, i) => {
      t.classList.toggle('active', (i === 0 && tab === 'login') || (i === 1 && tab === 'signup'));
    });
    document.getElementById('loginPanel').classList.toggle('active', tab === 'login');
    document.getElementById('signupPanel').classList.toggle('active', tab === 'signup');
    clearMessage();
  }

  function selectRole(el, role) {
    document.querySelectorAll('.role-card').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
    selectedRole = role;

    // Hide all conditional fields
    ['contractorFields','architectFields','agentFields','mortgageFields'].forEach(id => {
      document.getElementById(id).classList.remove('visible');
    });

    // Show relevant fields
    const map = {
      contractor: 'contractorFields',
      architect:  'architectFields',
      agent:      'agentFields',
      mortgage:   'mortgageFields'
    };
    if (map[role]) document.getElementById(map[role]).classList.add('visible');
  }

  function showMessage(text, type) {
    const el = document.getElementById('authMessage');
    el.textContent = text;
    el.className = `auth-message ${type}`;
  }

  function clearMessage() {
    const el = document.getElementById('authMessage');
    el.className = 'auth-message';
    el.textContent = '';
  }

  async function handleLogin() {
    const email    = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;

    if (!email || !password) return showMessage('Please enter your email and password.', 'error');

    const btn = document.querySelector('#loginPanel .auth-btn');
    btn.textContent = 'Signing in‚Ä¶';
    btn.disabled = true;

    const { data, error } = await window.narrowSupabase.auth.signInWithPassword({ email, password });

    if (error) {
      showMessage(error.message, 'error');
      btn.textContent = 'Sign In ‚Üí';
      btn.disabled = false;
    } else {
      showMessage('Welcome back! Redirecting‚Ä¶', 'success');
      setTimeout(() => { window.location.href = 'index.html'; }, 1200);
    }
  }

  async function handleSignup() {
    const name     = document.getElementById('signupName').value.trim();
    const email    = document.getElementById('signupEmail').value.trim();
    const password = document.getElementById('signupPassword').value;

    if (!selectedRole)       return showMessage('Please select your account type.', 'error');
    if (!name)               return showMessage('Please enter your full name.', 'error');
    if (!email)              return showMessage('Please enter your email address.', 'error');
    if (password.length < 8) return showMessage('Password must be at least 8 characters.', 'error');

    const btn = document.querySelector('#signupPanel .auth-btn');
    btn.textContent = 'Creating account‚Ä¶';
    btn.disabled = true;

    const { data, error } = await window.narrowSupabase.auth.signUp({
      email,
      password,
      options: {
        data: { full_name: name, role: selectedRole }
      }
    });

    if (error) {
      showMessage(error.message, 'error');
      btn.textContent = 'Create My Account ‚Üí';
      btn.disabled = false;
      return;
    }

    // Save role-specific profile to the right table
    const userId = data.user?.id;
    if (userId) {
      if (selectedRole === 'contractor') {
        await window.narrowSupabase.from('contractor_profiles').insert({
          user_id:        userId,
          company_name:   document.getElementById('contractorCompany').value,
          license_number: document.getElementById('contractorLicense').value,
          service_area:   document.getElementById('contractorArea').value,
        });
      } else if (selectedRole === 'architect') {
        await window.narrowSupabase.from('architect_profiles').insert({
          user_id:        userId,
          full_name:      name,
          company_name:   document.getElementById('architectCompany').value,
          license_number: document.getElementById('architectLicense').value,
        });
      } else if (selectedRole === 'mortgage') {
        await window.narrowSupabase.from('mortgage_profiles').insert({
          user_id:        userId,
          full_name:      name,
          company_name:   document.getElementById('mortgageCompany').value,
          nmls_number:    document.getElementById('mortgageNmls').value,
          service_states: document.getElementById('mortgageStates').value,
        });
      }
      // homebuyer and agent profiles stored via auth metadata for now
    }

    showMessage('Account created! Check your email to confirm, then sign in.', 'success');
    btn.textContent = 'Create My Account ‚Üí';
    btn.disabled = false;
  }

  async function handleForgotPassword() {
    const email = document.getElementById('loginEmail').value.trim();
    if (!email) return showMessage('Enter your email above first.', 'error');

    const { error } = await window.narrowSupabase.auth.resetPasswordForEmail(email, {
      redirectTo: 'https://www.buildnarrow.com/login.html'
    });

    if (error) {
      showMessage(error.message, 'error');
    } else {
      showMessage('Password reset email sent! Check your inbox.', 'success');
    }
  }
</script>
</body>
</html>
